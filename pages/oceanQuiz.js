import Head from 'next/head'
import styles from '@/styles/oceanQuiz.module.css'
import Image from 'next/image'
import Link from 'next/link'
import { useState } from 'react'
import Navbar from '@/components/navbar'
import Topnavbar from '@/components/top-navbar'
import questions from '../data/quiz.json'

export default function oceanQuiz(){

    function waterSound(){
        let audio = new Audio("/music/waterdrop.mp3");
        audio.play()
    }

    function popSound(){
        let audio = new Audio("/music/Bubble-pop.mp3");
        audio.play()
    }

    function boopSound(){
        let audio = new Audio("/music/bubble-boop.mp3");
        audio.play()
    }

    const [currentQuestion, setCurrentQuestion] = useState(0);

    //hold all the selected answers
    const [selectedOptions, setSelectedOptions] = useState([]);

    const [score, setScore] = useState(0);
    const [showScore, setShowScore] = useState(false);

    const handlePrevious = () => {
        const prevQues = currentQuestion - 1;
        prevQues >= 0 && setCurrentQuestion(prevQues);
    };
      
    const handleNext = () => {
        const nextQues = currentQuestion + 1;
        nextQues < questions.length && setCurrentQuestion(nextQues);
    };

    const handleAnswerOption = (answer) => {
        setSelectedOptions([
            (selectedOptions[currentQuestion] = { answerByUser: answer }),
        ]);
        setSelectedOptions([...selectedOptions]);
        console.log(selectedOptions);
    };

    const handleSubmitButton = () => {
        let newScore = 0;
        for (let i = 0; i < questions.length; i++) {
          questions[i].answerOptions.map(
            (answer) =>
              answer.isCorrect &&
              answer.answer === selectedOptions[i]?.answerByUser &&
              (newScore += 1)
          );
        }
        setScore(newScore);
        setShowScore(true);
    };
      
    return(
        <>
            <Head>
            <title>Under the Waves | Quiz</title>
            <meta name="description" content="Generated by create next app" />
            <meta name="viewport" content="width=device-width, initial-scale=1" />
            <link rel="icon" href="/Pixel/utwalogo.png" />
            </Head>
            <main className={styles.main}>
                <audio autoPlay src={"/music/Gelato-beach.mp3"} loop="true" autostart="true"></audio>
                <Topnavbar/>
                <h1 className={styles.headerTitle}>Quiz</h1>
                <div className={styles.content_section}>
                    <Link href={"/quiz"}>
                        <Image
                            onClick={boopSound}
                            className={styles.back}
                            src={"/buttons/back.svg"}
                            width={50}
                            height={50}
                            alt='back button'
                        />
                    </Link>
                    { showScore ? (
                        <div>
                            <Image 
                                className={styles.crabMove}
                                src={"/animals/velvet-crab.png"} 
                                width={100}
                                height={100}
                                alt='crab'
                                >
                            </Image>
                            <h3 className={styles.result}>
                                You scored: {score} out of {questions.length}
                            </h3>
                            <h4>take another quiz?</h4>
                            <div className={styles.categorySection}>
                                <div className={styles.quizSection} >
                                    <Image 
                                        className={styles.quizCover} 
                                        src={"/animals/clown-fish.png"} 
                                        width={50} 
                                        height={50}
                                        alt='clown fish'
                                    />
                                    <a className={styles.quizLink} href={"/ fishQuiz"}>
                                        About Fishes
                                    </a>
                                </div>
                                <div className={styles.quizSection}>
                                    <Image 
                                        className={styles.quizCover} 
                                        src={"/animals/octopus1.png"} 
                                        width={40} 
                                        height={40}
                                        alt='octopus'
                                    />
                                    <a className={styles.quizLink} href={"/wasteQuiz"}>
                                        About The environment
                                    </a>
                                </div>
                            </div>
                            <Link href={"/"} className={styles.buttons_section}>
                                <Image
                                    onClick={waterSound}
                                    className={styles.buttons}
                                    src={"/buttons/backtohome.svg"}
                                    width={150}
                                    height={60}
                                    alt='back to home'
                                /> 
                            </Link>
                        </div>
                        ) : (
                            <>
                                <div className={styles.questionRow}>
                                    <Image
                                        src={"/animals/blue-whale.png"} 
                                        width={50} 
                                        height={50}
                                        alt='blue whale'
                                    />
                                    <h4>
                                        Question {currentQuestion + 1} of {questions.length}
                                    </h4>
                                </div>
                                <div className={styles.questions}>
                                    {questions[currentQuestion].question}
                                </div>
                                <div>
                                    {questions[currentQuestion].answerOptions.map((answer, index) => (
                                    <div
                                        className={styles.answerOptions}
                                        key={index}
                                        onClick={() => handleAnswerOption(answer.answer)}
                                    >
                                        <input
                                            onClick={popSound}
                                            className={styles.check_box}
                                            type="radio"
                                            name={answer.answer}
                                            value={answer.answer}
                                            checked={answer.answer === selectedOptions[currentQuestion]?.answerByUser}
                                            onChange={() => handleAnswerOption(answer.answer)}
                                        />
                                        <p onClick={popSound}>{answer.answer}
                                        </p>
                                    </div>
                                    ))}
                                </div>
                                <div className={styles.buttons_section}>
                                    <div onClick={() => {
                                        handlePrevious()
                                        boopSound()
                                    }}>
                                        <Image
                                            className={styles.buttons}
                                            src={"/buttons/prevButton.svg"}
                                            width={160}
                                            height={60}
                                            alt='previous button'
                                        /> 
                                    </div>
                                    <div
                                        onClick={
                                            currentQuestion + 1 === questions.length
                                            ? handleSubmitButton
                                            : handleNext
                                        }
                                    >
                                    {currentQuestion + 1 === questions.length ? 
                                        <Image
                                            onClick={waterSound}
                                            className={styles.buttons}
                                            src={"/buttons/submitButton.svg"}
                                            width={160}
                                            height={60}
                                            alt='submit'
                                        /> 
                                        :   
                                        <Image 
                                            onClick={boopSound}
                                            className={styles.buttons}
                                            src={"/buttons/nextButton.svg"}
                                            width={160}
                                            height={60}
                                            alt='next'
                                        />
                                    }
                                    </div>
                                </div>
                            </>
                        )
                    }
                </div>
                <Navbar/>
            </main>
        </>
    )
}